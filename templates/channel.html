{% load static from staticfiles %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="" xmlns="http://www.w3.org/1999/html"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Software Engineering - Slam eNotes</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="{% static 'images/apple-touch-icon.png' %}">

        <link rel="stylesheet" href="{% static 'css/normalize.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/channel.css' %}?1480904394">
        <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
        <script src="{% static 'js/vendor/modernizr-2.8.3-respond-1.4.2.min.js' %}"></script>
    </head>
    <body class="full-height{% if theme == 'dark' %} dark{% endif %}">
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="header-container">
            <header class="wrapper clearfix">
                <h1 class="title">
                    <a href="{% url 'index' %}"><img src="{% if theme == 'dark' %}{% static 'images/logo-short-bright.png' %}{% else %}{% static 'images/logo-short.png' %}{% endif %}" alt="Slam eNotes" height="38" /></a>
                </h1>
                <input id="note-search" type="text" placeholder="search notes" />
            </header>
        </div>

        <div class="main-container">
            <div class="main wrapper clearfix">
                {% if user.is_authenticated %}
                <form id="note-form" method="post">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <p style="display:none">
                        Post a handwritten note (upload to <a href="http://imgur.com" target="_blank">Imgur</a> and submit link)
                        <input id="id_url" name="url" type="url" placeholder="http://i.imgur.com/...">
                    </p>
                    <p>
                        <input id="note-post" type="submit" value="Post">
                    </p>
                </form>
                {% else %}
                <p class="login-required">
                    You must be <a href="{% url 'index' %}#login-form">logged in</a> to post notes.
                </p>
                {% endif %}

                {% now "Y" as current_year %}
                {% now "M d, Y" as current_date %}
                <div id="results">
                    {% for note in notes %} {# Display all notes. #}
                        {% if note.body_text %} {# or note.url TODO: Enable this for handwritten notes #}
                    <article id="note-{{ note.id }}" tabindex="0" class="note">
                            {% if note.body_text %}
                        <div class="note-body"><p>{{ note.body_text }}</p></div> {# Display note text. #}
                            {% else %}
                        <figure class="note-image"><img src="{{ note.url }}"></figure> {# Display note image. #}
                            {% endif %}
                        <p class="note-meta clearfix">
                            {% if user.is_authenticated %}
                                {% if note.author == user %}
                            <span class="note-author">You,&nbsp;</span>
                                {% else %}
                            <span class="note-author">{{ note.author.email }},&nbsp;</span> {# Display note author's email for logged-in users. #}
                                {% endif %}
                            {% endif %}
                            <span class="note-date"> {# Display note created date. #}
                                {% with cd=note.created_date %}
                                <time datetime="{{ cd|date:"c" }}">
                                    {% if cd|date:"M d, Y" == current_date %}
                                        {{ cd|timesince }}
                                    {% else %} {# Intentionally ugly here to avoid whitespace between day and potential comma. #}
                                        {{ cd|date:"M d" }}{% if cd|date:"Y" != current_year %}{{ cd|date:", Y" }}{% endif %}
                                    {% endif %}
                                </time>
                                {% endwith %}
                            </span>
                            <span class="note-comments">0 comments</span>
                            {% if user.is_authenticated %}
                            <span class="note-actions">
                                {% if note.author == user or user.is_superuser %} {# Show the edit/delete buttons to the author, or a superuser #}
                                <a class="note-edit fa fa-pencil" href="#" role="button" aria-label="edit"></a><a class="note-delete fa fa-trash" href="{% url 'ajax' %}?action=delete&note={{ note.id }}" role="button" aria-label="delete"></a><a class="note-edit-cancel fa fa-times" href="#" role="button" aria-label="cancel edit"></a>
                                {% endif %}
                            </span>
                            {% endif %}
                        </p>
                    </article>
                        {% endif %}
                    {% endfor %}
                </div>
            </div> <!-- #main -->
            <span id="update-indicator">Notes changed. <a href="#">Update</a></span>
            <div id="invis-edit-form" class="invisible">
                {% if user.is_authenticated %}
                <form id="note-edit-form" method="post">
                    {% csrf_token %}
                    <p>
                        <textarea cols="" id="edit_body_text" name="body_text" placeholder="Write a note..." rows="" required=""></textarea>
                    </p>
                    <p>
                        <input id="note-edit-post" type="submit" value="Update">
                    </p>
                </form>
                {% endif %}
            </div>
            <div id="invis-deletion-container" class="visuallyhidden">
                <div id="note-delete-prompt">
                    <p>
                        Are you sure you want to delete this note?
                    </p>
                    <p id="note-delete-options">
                        <a id="note-delete-cancel" href="#" role="button" aria-label="cancel deletion">Cancel</a>
                        <a id="note-delete-proceed" href="#" role="button" aria-label="confirm deletion">Delete</a>
                    </p>
                </div>
            </div>
        </div> <!-- #main-container -->

        <aside class="sidebar-container">
            <div id="channel-overlay-circle"></div>
            <div id="courses">
                <h2 id="courses-menu-toggle" title="CS 3398.002 - Software Engineering">CS 3398.002 - Software Engineering</h2>
                <div class="courses-other">
                    <h2 id="courses-add">Add new class</h2>
                </div>
            </div>
            <h3 class="class-title">CLASS SESSIONS</h3>
            <div class="session-list">
                <h3 class="viewing">All Sessions</h3>
            </div>
            <button id="collapse-menu" class="fa fa-chevron-circle-left">Collapse Menu</button>
            <button id="expand-menu" class="fa fa-chevron-circle-right">Expand Menu</button>
        </aside>

        <aside class="channel-overlay">
            <nav id="overlay-tabs">
                <button id="overlay-tab-search"><span class="fa fa-search"></span> Search classes</button>
                <button id="overlay-tab-create">+ Create new class</button>
            </nav>
            <button id="channel-overlay-close"></button>
            <section id="channel-overlay-search">
                Search existing channels...
            </section>
            <section id="channel-overlay-create">
                Create a new channel...
                <form id="channel-creation-form" method="post">
                    <p>
                        <label>Prefix:</label> <input type="text">
                    </p>
                    <p>
                        <label>Number:</label> <input type="number" placeholder="Number">
                    </p>
                    <p>
                        <label>Section:</label> <input type="number" placeholder="Section">
                    </p>
                    <p>
                        <label>Postfix:</label> <input type="text">
                    </p>
                    <p>
                        <label>Title:</label> <input type="text">
                    </p>
                    <p>
                        <label>Instructor:</label> <input type="text">
                    </p>
                    <p>
                        <label>First class day:</label> <input type="text" placeholder="MM/DD/YYYY">
                    </p>
                    <p>
                        <label>Last class day:</label> <input type="text" placeholder="MM/DD/YYYY">
                    </p>
                    <p>
                        Meeting days:
                        <input type="checkbox"> <label>Mon</label>
                        <input type="checkbox"> <label>Tue</label>
                        <input type="checkbox"> <label>Wed</label>
                        <input type="checkbox"> <label>Thu</label>
                        <input type="checkbox"> <label>Fri</label>
                        <input type="checkbox"> <label>Sat</label>
                    </p>
                    <p>
                        <label>Class start time:</label> <input type="text" placeholder="HH:mm">
                    </p>
                    <p>
                        <label>Class end time:</label> <input type="text" placeholder="HH:mm">
                    </p>
                    <p>
                        <input type="submit" value="Create channel">
                    </p>
                </form>
            </section>
        </aside>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="{% static 'js/vendor/jquery-1.11.2.min.js' %}"><\/script>')</script>
        <script src="{% static 'js/vendor/jquery.ns-autogrow.min.js' %}"></script>

        <script>
            $('#id_body_text').autogrow({vertical: true, horizontal: false, flickering: false});
            $('#edit_body_text').autogrow({vertical: true, horizontal: false, flickering: false});

            if ($( window ).width() < 800) // 50rem
                $("body").addClass("menu-closed");


            var ajax_url = "{% url 'ajax' %}";

            var notes_changes = new Object();
            var last_update = new Date();
            var user = new Object();
            user.is_authenticated = {% if user.is_authenticated %}true;
            user.is_superuser = {% if user.is_superuser %}true;{% else %}false;{% endif %}
            user.email = "{{ user.email }}";{% else %}false;{% endif %}
        </script>
        <script src="{% static 'js/channel.js' %}?1480904394" onload="applyNoteActions();setTimeout(ajaxLiveUpdate, 5 * 1000);"></script>
        <script src="{% static 'js/vendor/commonmark.js' %}" onload="commonmarkParseAll();"></script>
    </body>
</html>
