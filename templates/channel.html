{% load static from staticfiles %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Software Engineering - Slam eNotes</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="{% static 'images/apple-touch-icon.png' %}">

        <link rel="stylesheet" href="{% static 'css/normalize.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/channel.css' %}?1480653905">
        <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
        <script src="{% static 'js/vendor/modernizr-2.8.3-respond-1.4.2.min.js' %}"></script>
    </head>
    <body class="full-height{% if theme == 'dark' %} dark{% endif %}">
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="header-container">
            <header class="wrapper clearfix">
                <h1 class="title">
                    <a href="{% url 'index' %}"><img src="{% static 'images/logo-short.png' %}" alt="Slam eNotes" height="38" /></a>
                </h1>
                <input id="note-search" type="text" placeholder="search notes" />
            </header>
        </div>

        <div class="main-container">
            <div class="main wrapper clearfix">
                {% if user.is_authenticated %}
                <form id="note-form" method="post">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <p style="display:none">
                        Post a handwritten note (upload to <a href="http://imgur.com" target="_blank">Imgur</a> and submit link)
                        <input id="id_url" name="url" type="url" placeholder="http://i.imgur.com/...">
                    </p>
                    <p>
                        <input id="note-post" type="submit" value="Post">
                    </p>
                </form>
                {% else %}
                <p class="login-required">
                    You must be <a href="{% url 'index' %}#login-form">logged in</a> to post notes.
                </p>
                {% endif %}

                {% now "Y" as current_year %}
                {% now "M d, Y" as current_date %}
                <div id="results">
                    {% for note in notes %} {# Display all notes. #}
                        {% if note.body_text %} {# or note.url TODO: Enable this for handwritten notes #}
                    <article id="note-{{ note.id }}" tabindex="0" class="note">
                            {% if note.body_text %}
                        <div class="note-body"><p>{{ note.body_text }}</p></div> {# Display note text. #}
                            {% else %}
                        <figure class="note-image"><img src="{{ note.url }}"></figure> {# Display note image. #}
                            {% endif %}
                        <p class="note-meta clearfix">
                            {% if user.is_authenticated %}
                                {% if note.author == user %}
                            <span class="note-author">You,&nbsp;</span>
                                {% else %}
                            <span class="note-author">{{ note.author.email }},&nbsp;</span> {# Display note author's email for logged-in users. #}
                                {% endif %}
                            {% endif %}
                            <span class="note-date"> {# Display note created date. #}
                                {% with cd=note.created_date %}
                                <time datetime="{{ cd|date:"c" }}">
                                    {% if cd|date:"M d, Y" == current_date %}
                                        {{ cd|timesince }}
                                    {% else %} {# Intentionally ugly here to avoid whitespace between day and potential comma. #}
                                        {{ cd|date:"M d" }}{% if cd|date:"Y" != current_year %}{{ cd|date:", Y" }}{% endif %}
                                    {% endif %}
                                </time>
                                {% endwith %}
                            </span>
                            <span class="note-comments">0 comments</span>
                            {% if user.is_authenticated %}
                            <span class="note-actions">
                                {% if note.author == user or user.is_superuser %} {# Show the edit/delete buttons to the author, or a superuser #}
                                <a class="note-edit fa fa-pencil" href="#" role="button" aria-label="edit"></a><a class="note-delete fa fa-trash" href="{% url 'ajax' %}?action=delete&note={{ note.id }}" role="button" aria-label="delete"></a><a class="note-edit-cancel fa fa-times" href="#" role="button" aria-label="cancel edit"></a>
                                {% endif %}
                            </span>
                            {% endif %}
                        </p>
                    </article>
                        {% endif %}
                    {% endfor %}
                </div>
            </div> <!-- #main -->
            <span id="update-indicator">Notes changed. <a href="#">Update</a></span>
            <div id="invis-edit-form" class="visuallyhidden">
                {% if user.is_authenticated %}
                <form id="note-edit-form" method="post">
                    {% csrf_token %}
                    <p>
                        <textarea cols="" id="edit_body_text" name="body_text" placeholder="Write a note..." rows="" required=""></textarea>
                    </p>
                    <p>
                        <input id="note-edit-post" type="submit" value="Update">
                    </p>
                </form>
                {% endif %}
            </div>
        </div> <!-- #main-container -->

        <aside class="sidebar-container">
            <div id="courses">
                <h2 id="courses-menu-toggle" title="CS 3398.002 - Software Engineering">CS 3398.002 - Software Engineering</h2>
                <div class="courses-other">
                    <h2 id="courses-add">Add new class</h2>
                </div>
            </div>
            <h3 class="class-title">CLASS SESSIONS</h3>
            <div class="session-list">
                <h3 class="viewing">All Sessions</h3>
            </div>
            <a id="collapse-menu" class="fa fa-chevron-circle-left" href="#">Collapse Menu</a>
            <a id="expand-menu" class="fa fa-chevron-circle-right" href="#">Expand Menu</a>
        </aside>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="{% static 'js/vendor/jquery-1.11.2.min.js' %}"><\/script>')</script>
        <script src="{% static 'js/vendor/jquery.ns-autogrow.min.js' %}"></script>

        <script>
            $('#id_body_text').autogrow({vertical: true, horizontal: false, flickering: false});
            $("#courses-menu-toggle").click(function() {$("#courses").toggleClass('courses-menu-open');});
            $("#collapse-menu").click(function() {$(document.body).toggleClass('menu-closed');});
            $("#expand-menu").click(function() {$(document.body).toggleClass('menu-closed');});

            var ajax_url = "{% url 'ajax' %}";

            var notes_changes = new Object();
            var last_update = new Date();
            var user = new Object();
            user.is_authenticated = {% if user.is_authenticated %}true;
            user.is_superuser = {% if user.is_superuser %}true;{% else %}false;{% endif %}
            user.email = "{{ user.email }}";{% else %}false;{% endif %}
        </script>
        <script src="{% static 'js/channel.js' %}?1480637434" onload="applyNoteActions();setTimeout(ajaxLiveUpdate, 5 * 1000);"></script>
        <script src="{% static 'js/vendor/commonmark.js' %}" onload="commonmarkParseAll();"></script>
    </body>
</html>
